<div class="container mx-auto max-h-screen overflow-y-auto w-full p-4">
  <div class="flex-1 flex justify-center">
    <h1 class="text-5xl font-bold mt-1 mb-2 text-secondary">Ingredientes</h1>
  </div>

  <div class="flex space-x-3 justify-end mb-4">
    <hlm-dialog class="bg-white">
      <button
        id="add-ingrediente-trigger"
        (click)="onAdd()"
        brnDialogTrigger
        hlmBtn
        variant="warning"
        class="text-white"
      >
        Agregar ingrediente
      </button>
      <hlm-dialog-content class="sm:max-w-[425px]" *brnDialogContent="let ctx">
        <hlm-dialog-header>
          <h3 hlmDialogTitle>Agregar ingrediente</h3>
        </hlm-dialog-header>
        <form
          (ngSubmit)="onSubmitAdd(ingredienteFormAdd, ctx)"
          #ingredienteFormAdd="ngForm"
        >
          <div class="py-4 grid gap-4">
            <!-- Campos del formulario -->
            <div class="items-center grid grid-cols-4 gap-4">
              <label hlmLabel for="idProducto-add" class="text-right"
                >Producto</label
              >
              <select
                hlmInput
                id="idProducto-add"
                name="idProducto"
                [(ngModel)]="ingrediente.idProducto"
                class="col-span-3"
                required
              >
                <option
                  *ngFor="let producto of productos$ | async"
                  [value]="producto.id"
                >
                  {{ producto.nombre }}
                </option>
              </select>
            </div>
            <div class="items-center grid grid-cols-4 gap-4">
              <label hlmLabel for="idMateriaPrima-add" class="text-right"
                >Materia Prima</label
              >
              <select
                hlmInput
                id="idMateriaPrima-add"
                name="idMateriaPrima"
                [(ngModel)]="ingrediente.idMateriaPrima"
                class="col-span-3"
                required
              >
                <option
                  *ngFor="let materiaPrima of materiasPrimas$ | async"
                  [value]="materiaPrima.id"
                >
                  {{ materiaPrima.material }}
                </option>
              </select>
            </div>
            <div class="items-center grid grid-cols-4 gap-4">
              <label hlmLabel for="cantidad-add" class="text-right"
                >Cantidad</label
              >
              <input
                hlmInput
                id="cantidad-add"
                name="cantidad"
                [(ngModel)]="ingrediente.cantidad"
                placeholder="Cantidad"
                class="col-span-3"
                required
              />
            </div>
            <div class="items-center grid grid-cols-4 gap-4">
              <label hlmLabel for="unidadMedida-add" class="text-right"
                >Unidad de Medida</label
              >
              <select
                hlmInput
                id="unidadMedida-add"
                name="unidadMedida"
                [(ngModel)]="ingrediente.unidadMedida"
                class="col-span-3"
                required
              >
                <option value="taza">Taza</option>
                <option value="cucharadita">Cucharadita</option>
                <option value="cucharada">Cucharada</option>
                <option value="unidad">Unidad</option>
                <option value="shot">Shot</option>
                <option value="Gr">Gr</option>
                <option value="Kg">Kg</option>
                <option value="Lt">Lt</option>
                <option value="Ml">Ml</option>
              </select>
            </div>
          </div>
          <hlm-dialog-footer>
            <button hlmBtn type="submit" variant="warning" class="text-white">
              Registrar
            </button>
          </hlm-dialog-footer>
        </form>
      </hlm-dialog-content>
    </hlm-dialog>

    <hlm-dialog>
      <button
        id="edit-ingrediente-trigger"
        brnDialogTrigger
        hlmBtn
        class="hidden"
      >
        Editar ingrediente
      </button>
      <hlm-dialog-content class="sm:max-w-[425px]" *brnDialogContent="let ctx">
        <hlm-dialog-header>
          <h3 hlmDialogTitle>Editar ingrediente</h3>
          <p hlmDialogDescription>
            Actualiza los detalles del ingrediente. Haz clic en actualizar
            cuando termines.
          </p>
        </hlm-dialog-header>
        <form
          (ngSubmit)="onSubmitEdit(ingredienteFormEdit, ctx)"
          #ingredienteFormEdit="ngForm"
        >
          <div class="py-4 grid gap-4">
            <!-- Campos del formulario -->
            <div class="items-center grid grid-cols-4 gap-4">
              <label hlmLabel for="idProducto-edit" class="text-right"
                >Producto</label
              >
              <select
                hlmInput
                id="idProducto-edit"
                name="idProducto"
                [(ngModel)]="ingrediente.idProducto"
                class="col-span-3"
                required
              >
                <option
                  *ngFor="let producto of productos$ | async"
                  [value]="producto.id"
                >
                  {{ producto.nombre }}
                </option>
              </select>
            </div>
            <div class="items-center grid grid-cols-4 gap-4">
              <label hlmLabel for="idMateriaPrima-edit" class="text-right"
                >Materia Prima</label
              >
              <select
                hlmInput
                id="idMateriaPrima-edit"
                name="idMateriaPrima"
                [(ngModel)]="ingrediente.idMateriaPrima"
                class="col-span-3"
                required
              >
                <option
                  *ngFor="let materiaPrima of materiasPrimas$ | async"
                  [value]="materiaPrima.id"
                >
                  {{ materiaPrima.material }}
                </option>
              </select>
            </div>
            <div class="items-center grid grid-cols-4 gap-4">
              <label hlmLabel for="cantidad-edit" class="text-right"
                >Cantidad</label
              >
              <input
                hlmInput
                id="cantidad-edit"
                name="cantidad"
                [(ngModel)]="ingrediente.cantidad"
                placeholder="Cantidad"
                class="col-span-3"
                required
              />
            </div>
            <div class="items-center grid grid-cols-4 gap-4">
              <label hlmLabel for="unidadMedida-add" class="text-right"
                >Unidad de Medida</label
              >
              <select
                hlmInput
                id="unidadMedida-add"
                name="unidadMedida"
                [(ngModel)]="ingrediente.unidadMedida"
                class="col-span-3"
                required
              >
                <option value="taza">Taza</option>
                <option value="cucharadita">Cucharadita</option>
                <option value="cucharada">Cucharada</option>
                <option value="unidad">Unidad</option>
                <option value="shot">Shot</option>
                <option value="Gr">Gr</option>
                <option value="Kg">Kg</option>
                <option value="Lt">Lt</option>
                <option value="Ml">Ml</option>
              </select>
            </div>
          </div>
          <hlm-dialog-footer>
            <button hlmBtn type="submit" variant="warning" class="text-white">
              Actualizar
            </button>
          </hlm-dialog-footer>
        </form>
      </hlm-dialog-content>
    </hlm-dialog>
  </div>

  <div class="flex flex-col justify-between gap-4 sm:flex-row">
    <input
      hlmInput
      class="w-full md:w-80"
      placeholder="Buscar por ID del Producto"
    />
    <button
      hlmBtn
      variant="warning"
      class="text-white me-3"
      align="end"
      [brnMenuTriggerFor]="menu"
    >
      Ver columnas
      <hlm-icon name="lucideChevronDown" class="ml-2" size="sm" />
    </button>
    <ng-template #menu>
      <hlm-menu class="w-32 bg-white">
        <button
          *ngFor="let column of allColumns; trackBy: trackByColumnName"
          hlmMenuItemCheckbox
          [disabled]="isColumnDisabled(column.name)"
          [checked]="isColumnVisible(column.name)"
          (click)="toggleColumnVisibility(column.name)"
        >
          <hlm-menu-item-check />
          <span>{{ column.label }}</span>
        </button>
      </hlm-menu>
    </ng-template>
  </div>

  <div class="items-center grid grid-cols-6 gap-4 mt-5">
    <label hlmLabel for="idProducto-add" class="text-right"
      >Selecciona un Producto</label
    >
    <select
      hlmInput
      id="idProducto-add"
      name="idProducto"
      [(ngModel)]="ingrediente.idProducto"
      (change)="onProductSelect($event)"
      class="col-span-3"
      required
    >
      <option *ngFor="let producto of productos$ | async" [value]="producto.id">
        {{ producto.nombre }}
      </option>
    </select>
  </div>

  <brn-table
    hlm
    stickyHeader
    class="border-border mt-4 block h-[335px] overflow-auto rounded-md border"
    [dataSource]="(ingredientes$ | async) || []"
    [displayedColumns]="displayedColumns"
  >
    <!-- Columna de ID -->
    <brn-column-def name="ID" class="w-12">
      <hlm-th *brnHeaderDef class="text-center">ID</hlm-th>
      <hlm-td *brnCellDef="let element" class="text-center">{{
        element.id
      }}</hlm-td>
    </brn-column-def>

    <!-- Columna de Materia Prima -->
    <brn-column-def name="material" class="flex-1">
      <hlm-th *brnHeaderDef class="text-center">Materia Prima</hlm-th>
      <hlm-td *brnCellDef="let element" class="text-center">{{
        element.material
      }}</hlm-td>
    </brn-column-def>

    <!-- Columna de Cantidad -->
    <brn-column-def name="cantidad" class="flex-1">
      <hlm-th *brnHeaderDef class="text-center">Cantidad</hlm-th>
      <hlm-td *brnCellDef="let element" class="text-center">{{
        element.cantidad
      }}</hlm-td>
    </brn-column-def>

    <!-- Columna de Unidad de Medida -->
    <brn-column-def name="unidadMedida" class="flex-1">
      <hlm-th *brnHeaderDef class="text-center">Unidad de Medida</hlm-th>
      <hlm-td *brnCellDef="let element" class="text-center">{{
        element.unidadMedida
      }}</hlm-td>
    </brn-column-def>

    <!-- Columna de Acciones -->
    <brn-column-def name="acciones" class="flex-1">
      <hlm-th *brnHeaderDef class="text-center">Acciones</hlm-th>
      <hlm-td *brnCellDef="let element" class="text-center">
        <button
          hlmBtn
          variant="warning"
          (click)="onEdit(element)"
          class="mr-2 text-white"
        >
          Editar
        </button>
        <button
          hlmBtn
          variant="destructive"
          (click)="onDelete(element.id)"
          class="text-white"
        >
          Eliminar
        </button>
      </hlm-td>
    </brn-column-def>

    <!-- Mensaje de no hay datos -->
    <div
      class="flex items-center justify-center p-20 text-muted-foreground text-center"
      *ngIf="(ingredientes$ | async)?.length === 0"
    >
      No hay datos de ingredientes
    </div>
  </brn-table>

  <!-- Controles de paginación -->
  <div
    class="flex flex-col justify-between mt-4 sm:flex-row sm:items-center px-5"
  >
    <span class="text-sm text-muted-foreground"
      >{{ totalIngredientes }} Ingredientes</span
    >
    <div class="flex mt-2 sm:mt-0">
      <button
        (click)="onPageChange(pageIndex - 1)"
        [disabled]="pageIndex === 0"
        hlmBtn
        variant="outline"
      >
        Anterior
      </button>
      <button (click)="onPageChange(pageIndex + 1)" hlmBtn variant="outline">
        Siguiente
      </button>
    </div>
  </div>
</div>
