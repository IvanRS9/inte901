<home-navbar></home-navbar>
<section class="flex flex-col items-center justify-between p-4 h-[calc(100vh-3rem)] w-screen">
  <div class="grid grid-cols-12 w-full h-full">
    <div class="col-span-4 only-border-right h-full">
      <div>
        <h2>Tus direcciones</h2>
        @for (dir of address().direcciones; track $index) {
          <div class="flex justify-between items-center border border-black rounded-lg px-4 py-2 my-2">
            <div class="flex items-center">
              <lucide-icon name="house"></lucide-icon>
              <span>{{dir.calle}}, {{dir.colonia}}</span>
            </div>
            
<hlm-alert-dialog>
  <button id='edit-profile' brnAlertDialogTrigger hlmBtn
  class="bg-white"
  >
    <lucide-icon name='trash'></lucide-icon>
  </button>
  <hlm-alert-dialog-content *brnAlertDialogContent='let ctx'>
    <hlm-alert-dialog-header>
      <h3 hlmAlertDialogTitle>¿Estás seguro de que deseas esta dirección?</h3>
      <p hlmAlertDialogDescription>
        Esta acción no se puede deshacer. Esta eliminará la dirreción de tu cuenta.
      </p>
    </hlm-alert-dialog-header>
    <hlm-alert-dialog-footer>
      <button hlmAlertDialogCancel (click)='ctx.close()'>Cancelar</button>
      <button hlmAlertDialogAction (click)='ctx.close()'
      (click)="onDeleteAddress(dir)"
      >Eliminar dirección</button>
    </hlm-alert-dialog-footer>
  </hlm-alert-dialog-content>
</hlm-alert-dialog>

            <button
            (click)="onClickEdit(dir)"
            >
              <lucide-angular name="pencil"></lucide-angular>
            </button>
          </div>
        }
      </div>
    </div>
    <div class="col-span-8 px-4">
      <h2>Agregar dirección</h2>
      <div>
        <form class="grid grid-cols-2 gap-4">
          <div>
            <label
            class="block text-sm font-medium text-gray-700"
            >Calle</label>
            <input
              type="text"
              hlmInput
              ngModel
              [ngModelOptions]="{standalone: true}"
              [formField]="formModel.controls.calle"
            />
            @if (formModel.controls.calle.touched()) {
              @if (formModel.controls.calle.hasError('required')) {
                <div class="text-red-500 text-sm">El correo electrónico es requerido</div>
              } @else if (formModel.controls.calle.hasError('maxLength')) {
                <div class="text-red-500 text-sm">El correo electrónico debe tener menos de 50 caracteres</div>
              } @else if (formModel.controls.calle.hasError('email')) {
                <div class="text-red-500 text-sm">El correo electrónico no es válido</div>
              }
            }
          </div>
          <div>
            <label
            class="block text-sm font-medium text-gray-700"
            >Colonia</label>
            <input
              type="text"
              hlmInput
              ngModel
              [ngModelOptions]="{standalone: true}"
              [formField]="formModel.controls.colonia"
            />
            @if (formModel.controls.colonia.touched()) {
              @if (formModel.controls.colonia.hasError('required')) {
                <div class="text-red-500 text-sm">La colonia es requerida</div>
              } @else if (formModel.controls.colonia.hasError('maxLength')) {
                <div class="text-red-500 text-sm">La colonia debe tener menos de 50 caracteres</div>
              }
            }
          </div>
          <div>
            <label>Ciudad</label>
            <input
              type="text"
              hlmInput
              ngModel
              [ngModelOptions]="{standalone: true}"
              [formField]="formModel.controls.ciudad"
            />
            @if (formModel.controls.ciudad.touched()) {
              @if (formModel.controls.ciudad.hasError('required')) {
                <div class="text-red-500 text-sm">El código postal es requerido</div>
              } @else if (formModel.controls.ciudad.hasError('maxLength')) {
                <div class="text-red-500 text-sm">El código postal debe tener menos de 10 caracteres</div>
              }
            }
          </div>
          <div>
            <label>Código postal</label>
            <input
              type="text"
              hlmInput
              ngModel
              [ngModelOptions]="{standalone: true}"
              [formField]="formModel.controls.codigoPostal"
            />
            @if (formModel.controls.codigoPostal.touched()) {
              @if (formModel.controls.codigoPostal.hasError('required')) {
                <div class="text-red-500 text-sm">El código postal es requerido</div>
              } @else if (formModel.controls.codigoPostal.hasError('maxLength')) {
                <div class="text-red-500 text-sm">El código postal debe tener menos de 10 caracteres</div>
              }
            }
          </div>
          
          <div>
            <label for="state" class="block text-sm font-medium text-gray-700">
              Estado
            </label>
            <brn-popover
              [state]="state()"
              (stateChanged)="stateChanged($event)"
              sideOffset="5"
              closeDelay="100"
            >
              <button
                class="w-[200px] justify-between"
                id="edit-profile"
                variant="outline"
                brnPopoverTrigger
                hlmBtn
              >
                {{ currentFramework() ? currentFramework()?.label : 'Select framework...' }}
                <lucide-icon name="chevron-down"></lucide-icon>
              </button>
              <brn-cmd
                *brnPopoverContent="let ctx"
                hlmPopoverContent
                hlm
                class="p-0 w-[200px] z-50 bg-white"
              >
                <hlm-cmd-input-wrapper>
                  <lucide-icon name="search"></lucide-icon>
                  <input
                    placeholder="Buscar..."
                    id="search"
                    brnCmdInput
                    hlm
                  />
                </hlm-cmd-input-wrapper>
                <div *brnCmdEmpty hlmCmdEmpty>No hay resultados</div>
                <brn-cmd-list hlm>
                  <brn-cmd-group hlm>
                    <button
                      *ngFor="let framework of mexicanStates"
                      brnCmdItem
                      [value]="framework.value"
                      (selected)="commandSelected(framework)"
                      class="bg-white text-black hover:bg-gray-100 w-full text-left p-2"
                      hlm
                    >
                      <hlm-icon
                        [class.opacity-0]="currentFramework()?.value !== framework.value"
                        name="lucideCheck"
                        hlmCmdIcon
                      />
                      {{ framework.label }}
                    </button>
                  </brn-cmd-group>
                </brn-cmd-list>
              </brn-cmd>
            </brn-popover>
          </div>
          <div>
           @if(isEdit()){
            <button hlmBtn
            variant="primary"
            (click)="onEditAddress()"
            >Editar dirección</button>
           }@else {
            <button hlmBtn
            variant="primary"
            (click)="onCreatedAddress()"
            >Agregar dirección</button>
           }

          </div>
          <div>
            <button hlmBtn
            variant="destructive"
            (click)="onClearForm()"
            >Cancelar</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</section>
